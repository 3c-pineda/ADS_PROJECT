<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="/admin/mainAdminCss.css">
    <link rel="stylesheet" type="text/css" href="/admin/adminTableCss.css">
    <title>Admin - View Database</title>
</head>

<body>
     <!-- NAVIGATION BAR -->
     <%- include('adminPartials/adminNav.ejs', { activePage: 'home' }); %>
      
        <button id="restoreTable"><h2>></h2></button>
        <main>
            

            <!-- First Table with 19 headers -->
            <div class="titleContainer">
            <h1> SHELTER DATABASE</h1>
            </div>
            <div class="table-container">
               
                <table id="mainTable">
                    <thead>
                        <tr>
                            <th>Animals ID</th>
                            <th>Name</th>
                            <th>Species</th>
                            <th>Breed</th>
                            <th>Age</th>
                            <th>Sex</th>
                            <th>Characteristics</th>
                            <th>Health Status</th>
                            <th id="tableAction">Action</th>
                        </tr>
                    </thead>
                    <tbody>
                            <% if (animals && animals.length > 0) { %>
                              <% animals.forEach(animal => { %>
                                <tr>
                                  <td><%= animal.animal_id %></td>
                                  <td><%= animal.name %></td>
                                  <td><%= animal.species %></td>
                                  <td><%= animal.breed %></td>
                                  <td><%= animal.age %></td>
                                  <td><%= animal.sex %></td>
                                  <td><%= animal.characteristics %></td>
                                  <td><%= animal.health_status %></td>
                                  <td>
                                    <div class="actionButtonContainer">
                                      <button onclick="redirectToViewWithId('<%= animal.id %>')" class="actionButtons">View</button>
                                      <a href="/admin/adminEdit/<%= animal.animal_id %>" class="actionButtons">Modify</a>
                                      <form action="/admin/adminDelete" method="POST">
                                        <input type="hidden" name="animal_id" value='<%= animal.animal_id %>'>
                                        <input type="hidden" name="animal_name" value='<%= animal.name %>'>
                                        <input type="hidden" name="method" value="POST">
                                        <button type="submit" class="actionButtons">Delete</button>
                                      </form>
                                    </div>
                                  </td>
                                </tr>
                              <% }); %>
                            <% } else { %>
                              <tr>
                                <td colspan="19">No animals found in the database.</td>
                              </tr>
                            <% } %>
                    </tbody>
                </table>
                    
            </div>
            <!-- Second Table with 4 headers -->
            <div class="titleContainer">
            <h1>SHELTER MEDICAL HISTORY DATABASE </h1>
            
            </div>
            <div class="second-table-container">
                <table id="secondTable">
                    <thead>
                        <tr>
                            <th>Vaccination ID</th>
                            <th>Vaccination Type</th>
                            <th>Vaccination Date</th>
                            <th>Vaccination Dose</th>
                            <th>Animal ID</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% if (animalMed && animalMed.length > 0) { %>
                            <% animalMed.forEach(animal => { %>
                                <tr>
                                    <td><%= animal.vacc_id %></td>
                                    <td><%= animal.vacc_type %></td>
                                    <td><%= animal.vacc_date %></td>
                                    <td><%= animal.vacc_dose %></td>
                                    <td><%= animal.animal_id %></td>
                                </tr>
                            <% }); %>
                        <% } else { %>
                            <tr>
                                <td colspan="5">No medical history found in the database.</td>
                            </tr>
                        <% } %>
                        
                    </tbody>
                </table>
            </div>

        </main>
    </div>

    <script>
        function redirectToViewWithId(id) {
  location.href = http://localhost:3000/admin/adminView/${id};
}

function redirectToEditWithId(id) {
  window.location.href = `http://localhost:3000/admin/adminEdit/${id}`;
}

function redirectToDeleteWithId(id) {
  location.href = http://localhost:3000/admin/adminDelete/${id};
}

        
        // Navigation for header buttons
        let currentStartIndex = 0;
        const headersToShow = 10;
        const totalHeaders = 19;

        const updateTableHeaders = () => {
            const headers = document.querySelectorAll('#mainTable thead tr th');
            const rows = document.querySelectorAll('#mainTable tbody tr');
            headers.forEach((header, index) => {
                if (index < currentStartIndex || index >= currentStartIndex + headersToShow) {
                    header.style.display = 'none';
                } else {
                    header.style.display = '';
                }
            });
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                cells.forEach((cell, index) => {
                    if (index < currentStartIndex || index >= currentStartIndex + headersToShow) {
                        cell.style.display = 'none';
                    } else {
                        cell.style.display = '';
                    }
                });
            });
        };

        document.getElementById('prevHeaders').addEventListener('click', () => {
            if (currentStartIndex > 0) {
                currentStartIndex -= headersToShow;
                updateTableHeaders();
            }
        });

        document.getElementById('nextHeaders').addEventListener('click', () => {
            if (currentStartIndex + headersToShow < totalHeaders) {
                currentStartIndex += headersToShow;
                updateTableHeaders();
            }
        });

        // Initial update
        updateTableHeaders();
    </script>
</body>
</html>
